# Шаг 1: Загрузка, очистка и информация о файле (внутри контура пайплайна)

## Вход
- button: тип кнопки (`contractors | risks | errors | processes`).
- settings: путь к Excel-файлу из `.env` через `app/config.py` (`Contractor/Risk/Error/ProcessSettings.data_file_path`).
- вопрос и прочие параметры на этом шаге не используются (служат для логирования контекста).

## Что происходит внутри
1) Определение файла
- По `button` выбирается файл данных: подрядчики/риски/ошибки/процессы.
- Где: `ExcelLoader._get_file_path_and_description()`.

2) Проверка наличия
- Проверяем, что файл существует; логируем путь и информацию о файле (размер, время изменения, полный путь, расширение).
- Где: `ExcelLoader._check_file_exists()` и `_get_file_info()`.

3) Чтение Excel
- Загружаем таблицу `pandas.read_excel(...)`.
- Где: `ExcelLoader.load()`.

4) Базовая очистка (техническая)
- Удаляем артефакт `_x000D_` во всех строковых колонках.
- Удаляем двойные кавычки `"`.
- Тримминг пробелов по краям.
- Зачем: убрать технический мусор ещё до доменной нормализации (Шаг 2).
- Где: `ExcelLoader._clean_dataframe()`.

5) Диагностическое логирование
- Колонки, типы данных, пустые значения, первые строки (truncate), расходы памяти.
- Где: `ExcelLoader._log_dataframe_details()` и логгер пайплайна (`PipelineLogger`).

6) Возврат данных
- Возвращается очищенный `DataFrame` для следующего шага (нормализации).

## Выход
- pandas `DataFrame`: загруженные данные с базовой очисткой строк.
- Побочный эффект: подробные логи в `LOGS/dup_ai.log`.

## Ошибки и поведение
- Файл не найден или ошибка чтения: поднимается `HTTPException(500)` в `ExcelLoader`, шаг помечается как ошибка в `BasePipeline.process()` и пайплайн формирует понятный ответ об ошибке.

## Где в коде
- Оркестрация шага: `app/pipelines/base.py` ("ШАГ 1: Загрузка данных").
- Загрузка и очистка: `app/adapters/excel_loader.py`.
- Пути к файлам: `app/config.py` → `ContractorSettings/RiskSettings/ErrorSettings/ProcessSettings.data_file_path` (из `.env`).

## Почему так
- Быстрый и предсказуемый старт: базовая очистка сразу убирает технический шум.
- Унификация входа: независимо от кнопки, дальше все шаги работают с единым форматом `DataFrame`.
